# Флоу

![](/flow.png){width=300px}

Флоу — это движок для генерации сообщений. Он отвечает за порядок выполнения промптов и работу внутренней логики. 

Внутри флоу хранятся локальные копии всех пресетов, так что их редактирование не затронет глобальные настройки

Редактирование происходит через drag-and-drop. Новые ноды добавляются через ПКМ.

## Схемы

Каждая схема - это последовательность нод, которые выполняются последовательно. 

### Встроенные

По умолчанию доступны 3 схемы:

#### Main

Запускается, когда отправляется сообщение юзера.

#### Generate

Запускается при свайпе сообщения

#### Translate

Запускается при нажатии на кнопку перевода. Результат работы кешируется, так что при переключении повторный запуск не произойдет. Если изменить исходное сообщение, то запускается автоматически

### Дополнительные

Также доступно создание дополнительных схем. Каждая такая схема будет работать по принципу доп.блока и будет отображаться под исходным сообщением. В стандартном флоу доступны 2 доп.блока:

#### current_info

Блок-хелпер. Анализирует текущую сцену и генерирует краткую сводку об окружении и персонажах. Плацебо, чтобы лоботомит не путался в позах и не терял трусы.

##### summary

Суммаризация чата. Анализирует всю историю и пишет краткий пересказ произошедших событий. Работает в паре с код-блоком, который обрезает всю историю до последнего саммари

## Типы нод

### Start

Точка входа. Всегда присутствует и не может быть удален

### Create Message

Создаёт сообщение-заглушку с указанной ролью. Основная задача - создать пустое сообщение от лица ассистента, в котором в дальнейшем будет сгенерирован ответ от LLM.

### Generate

Генерирует новое сообщение. На вход принимает промпт.

### Translate

Переводит исходное сообщение на указанный язык. При этом исходный текст сохраняется и доступен для редактирования.

Для перевода используется yandex translate

### Run Scheme

Запускает другую ветку. Основное назначение - запустить автоматическую генерацию доп.блоков после генерации основного ответа. 

### Notify

Воспроизводит звуковое уведомление
